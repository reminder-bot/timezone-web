<html>
<head>

    <meta charset="UTF-8">

    <script src="/static/js/jquery.js"></script>
    <script src="/static/js/moment.js"></script>
    <script src="/static/js/moment-timezone.js"></script>
    <script src="/static/js/timezone-picker.min.js"></script>

    <link rel="stylesheet" href="/static/css/timezone-picker.css"></link>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css"></link>

    <style>
.Cbox select {
    background-color: #D8D8D8 !important;
    color: #505559 !important;
    font-size: small !important;
}
.timezone-map polygon[data-selected="true"] {fill: #496A84}.timezone-map polygon { fill: #BBB;}.timezone-map polygon.active {fill: #5A5A5A;}.timezone-map polygon:hover { cursor: pointer;}.Cbox .quickLink{width: 52%;float: right;padding-bottom: 11px;overflow-x: auto; white-space: nowrap;overflow-y: hidden;}.Cbox .quickLink span:hover {color:#FFF;background-color: #496A84;  cursor: pointer;}.Cbox select{width: 45%;float: left;height: 27px; padding: 0px 0px 0px 10px;}.Cbox .quickLink span.active {color: #FFF; background-color: #496A84;}.Cbox .quickLink span{ font-weight: 300; border-radius: 3px; color: #000; background-color: #FFF; border: solid 1px #CCC;margin-left: 10px;font-size: 9px;padding: 4px 6px 4px 6px;}

.form-elements {
    margin: 10px; padding: 10px; border-style: solid; border-color: black; border-radius: 2px; border-width: 1px; background-color: white;
}
    </style>

</head>
<body>
    {% if logged_in %}
    <br>
    <h2>Clock channels in your guilds:</h2>
    <div class="card-deck" style="margin: 10px; padding: 10px; border-style: solid; border-color: gray; border-radius: 2px; border-width: 1px; background-color: lightgray">
        {% for channel in channels %}
            <div class="card" style="max-width: 20rem; border-color: gray;">
                <div class="card-header">
                    {{ channel.guild }}
                </div>
                <div class="card-body">
                    <p>ID: <code>{{ channel.id }}</code></p>
                    <p>Timezone: <strong>{{ channel.timezone }}</strong></p>
                    <p>Formatting: <code>{{ channel.name }}</code></p>
                </div>
                <div class="card-footer">
                    <form method="POST" action="{{ delete_redir }}">
                        <input type="hidden" name="id" value="{{ channel.id }}"></input>
                        <button type="submit" class="btn btn-danger">Delete Clock</input>
                    </form>
                </div>
            </div>
        {% endfor %}
    </div>

    <h2>Create new channel:</h2>
    <form method="POST" action="{{ create_redir }}">
        <div style="margin: 10px; padding: 10px; border-style: solid; border-color: gray; border-radius: 2px; border-width: 1px; background-color: lightgray">
            <div class="form-group form-elements">
                <label for="guild-select">Select a guild:</label>
                <select id="guild-select" class="form-control" name="guild" required>
                    {% for guild in guilds %}
                        <option value="{{ guild.id }}">{{ guild.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group form-elements">
                <p>Select a timezone:</p>

                <noscript>
                    <select name="timezone" class="form-control">
                        {% for tz in timezones %}
                            <option value="{{ tz }}">{{ tz }}</option>
                        {% endfor %}
                    </select>
                    <p><em>If you want to use the interactive timezone selector, please disable noscript</em></p>
                </noscript>

                <div id="map">
                </div>
            </div>

            <script>
$('#map').timezonePicker({
    quickLink: [{
        "PST": "PST",
        "MST": "MST",
        "CST": "CST",
        "EST": "EST",
        "GMT": "GMT",
        "LONDON": "Europe/London"
    }],
    width: 1000,
    showHoverText: false
});
            </script>
            <script>
$(".country-lov")[0].name = "timezone";

const urlParams = new URLSearchParams(window.location.search);
const error = urlParams.get('err');

const error_map = {
    "No perms": "No permissions to create channel. Is the bot in the guild, and if so has it got full permissions?"
}

if (error != null) {
    alert(`An error occured: ${error_map[error]}`)
}

            </script>

            <div class="form-group form-elements">
                <label for="name-formating">Choose a name/formatting:</label>
                <input id="name-formatting" name="name" type="text" value="%H:%M" maxlen="20" required></input>
            </div>

            <button type="submit" class="btn btn-primary">Create Channel</input>
        </div>
    </form>

    {% else %}
    <a href="{{ login_redir }}">Log in with Discord</a>
    {% endif %}
</body>
</html>